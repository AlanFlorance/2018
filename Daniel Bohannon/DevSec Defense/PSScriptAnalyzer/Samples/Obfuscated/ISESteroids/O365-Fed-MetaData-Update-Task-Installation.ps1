#------------------------------------------------------------------------------
#
# Copyright © 2012 Microsoft Corporation.  All rights reserved.
#
# THIS CODE AND ANY ASSOCIATED INFORMATION ARE PROVIDED “AS IS” WITHOUT
# WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT
# LIMITED TO THE IMPLIED WARRANTIES OF MERCHANTABILITY AND/OR FITNESS
# FOR A PARTICULAR PURPOSE. THE ENTIRE RISK OF USE, INABILITY TO USE, OR 
# RESULTS FROM THE USE OF THIS CODE REMAINS WITH THE USER.
#
#------------------------------------------------------------------------------
#
# PowerShell Source Code
#
# NAME:
#    O365-Fed-MetaData-Update-Task-Installation.ps1
#
# VERSION:
#    1.2
#
#------------------------------------------------------------------------------

$ErrorActionPreference = "silentlycontinue"
${_/=\/=\_/\/=\/\__} = Get-Date
Write-Host "`n Microsoft Office 365 Federation Metadata Update Automation Installation Tool" -ForegroundColor Yellow
Write-Host "`n`n Items required to execute this tool successfully:"
Write-Host "`t1. Functioning AD FS 2.0 Federation Service"
Write-Host "`t2. Access to Global Administrator credentials for your Office 365 tenant (referred to as 'MSOL credentials')"
Write-Host "`t3. At least one verified domain in the Office 365 tenant must be of type 'Federated'"
Write-Host "`t4. This tool must be executed directly on a internal, writable Federation Server"
Write-Host "`t5. The local administrator domain credentials you provide must equal the currently logged on user"
Write-Host "`t6. The Microsoft Online Services Module for Windows PowerShell must be installed on the internal AD FS server"

#Check to make sure this is an AD FS server
${_/\_/\_/=\_/==\_/} = Get-Service ADFSSRV
If (!${_/\_/\_/=\_/==\_/})
{
	Write-Host "`n`tThe AD FS 2.0 Windows service was not found on this machine. Exiting...`n" -ForegroundColor Red
	Exit
}

#CredMan stuff
${/==\_/\_/\__/\__/} = @"
[DllImport("Advapi32.dll", SetLastError=true, EntryPoint="CredWriteW", CharSet=CharSet.Unicode)]
public static extern bool CredWrite([In] ref Credential userCredential, [In] UInt32 flags);
[StructLayout(LayoutKind.Sequential, CharSet=CharSet.Unicode)]
public struct Credential
{
   public UInt32 flags;
   public UInt32 type;
   public IntPtr targetName;
   public IntPtr comment;
   public System.Runtime.InteropServices.ComTypes.FILETIME lastWritten;
   public UInt32 credentialBlobSize;
   public IntPtr credentialBlob;
   public UInt32 persist;
   public UInt32 attributeCount;
   public IntPtr Attributes;
   public IntPtr targetAlias;
   public IntPtr userName;
}
"@
Add-Type -MemberDefinition ${/==\_/\_/\__/\__/} -Namespace "ADVAPI32" -Name 'Util'
${______/===\_/\/\_} = New-Object ADVAPI32.Util+Credential
${______/===\_/\/\_}.flags = 0
${______/===\_/\/\_}.type = 1

#Get Federated domain
While (!${_/\/\_/=\/\__/=\/}) {${_/\/\_/=\/\__/=\/} = (Read-Host "`n Federated domain (contoso.com)").ToUpper()}
While (!${_/=\_/\_/=\__/\_/}) {${_/=\_/\_/=\__/\_/} = (Read-Host "`n Confirm federated domain (contoso.com)").ToUpper()}
If (${_/\/\_/=\/\__/=\/} -ne ${_/=\_/\_/=\__/\_/})
{
	Write-Host "`n`tFederated domains do not match. Exiting...`n" -ForegroundColor Red
	Exit
}

#Get MSOL creds
While (!${___/\/===\_/\/=\/}) {${___/\/===\_/\/=\/} = (Read-Host "`n MSOL username (user`@domain)").ToUpper()}

#Set the name of the CredMan credentials
${/=\__/\_/\/=\/===} = $ExecutionContext.InvokeCommand.ExpandString([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('TQBpAGMAcgBvAHMAbwBmAHQALQBPAGYAZgBpAGMAZQAzADYANQAtAFUAcABkAGEAdABlAC0ATQBTAE8ATABGAGUAZABlAHIAYQB0AGUAZABEAG8AbQBhAGkAbgAtACQAewBfAC8AXAAvAFwAXwAvAD0AXAAvAFwAXwBfAC8APQBcAC8AfQA=')))
${______/===\_/\/\_}.targetName = [System.Runtime.InteropServices.Marshal]::StringToCoTaskMemUni(${/=\__/\_/\/=\/===})
${______/===\_/\/\_}.userName = [System.Runtime.InteropServices.Marshal]::StringToCoTaskMemUni(${___/\/===\_/\/=\/})
${______/===\_/\/\_}.attributeCount = 0
${______/===\_/\/\_}.persist = 2
While (!${/==\__/=\/=\__/=\}) {${/==\__/=\/=\__/=\} = Read-Host -assecurestring "`n MSOL password"}
${__/=\/\___/\/=\/=} = New-Object Management.Automation.PSCredential ${___/\/===\_/\/=\/}, ${/==\__/=\/=\__/=\}
${/==\__/=\/=\__/=\} = ${__/=\/\___/\/=\/=}.GetNetworkCredential().Password

#Validating MSOL creds
Write-Host "`n Validating MSOL credentials"
Import-Module MSOnline
Connect-MsolService -Credential ${__/=\/\___/\/=\/=}
If ($?)
{
	Write-Host "`n`tSuccess"  -ForegroundColor Green
}
Else
{
	Write-Host "`n`tFailed MSOL credential validation. Exiting...`n" -ForegroundColor Red
	Exit
}


${______/===\_/\/\_}.credentialBlobSize = [System.Text.Encoding]::Unicode.GetBytes(${/==\__/=\/=\__/=\}).length
${______/===\_/\/\_}.credentialBlob = [System.Runtime.InteropServices.Marshal]::StringToCoTaskMemUni(${/==\__/=\/=\__/=\})

#Store the MSOL creds in CredMan
${/=\/\/=\/====\/\_} = [ADVAPI32.Util]::CredWrite([ref]${______/===\_/\/\_},0)
If (${/=\/\/=\/====\/\_})
{
	Write-Host "`n`tAdded MSOL credentials to the local Credential Manager" -ForegroundColor Green
}
Else
{
	Write-Host "`n`tFailed adding MSOL credentials to the local Credential Manager. Exiting...`n" -ForegroundColor Red
	Exit
}

#Get local admin creds
${/=\__/\_/===\/\/=} = (WhoAmI.exe).ToUpper()
While (!${/===\/=\__/=\/\_/}) {${/===\/=\__/=\/\_/} = Read-Host -assecurestring $ExecutionContext.InvokeCommand.ExpandString([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('CgAgACQAewAvAD0AXABfAF8ALwBcAF8ALwA9AD0APQBcAC8AXAAvAD0AfQAgAHAAYQBzAHMAdwBvAHIAZAA=')))}
${__/=\/\___/\/=\/=} = New-Object Management.Automation.PSCredential ${/=\__/\_/===\/\/=}, ${/===\/=\__/=\/\_/}
${/===\/=\__/=\/\_/} = ${__/=\/\___/\/=\/=}.GetNetworkCredential().Password

# Validating domain credentials
Write-Host "`n Validating local admin domain credentials"
${__/===\/=\_/\/===} = "LDAP://" + ([ADSI]"").distinguishedName
${__/=\/=====\_/===} = New-Object System.DirectoryServices.DirectoryEntry(${__/===\/=\_/\/===},${/=\__/\_/===\/\/=},${/===\/=\__/=\/\_/})
`$DomainObject.Name = `$DomainObject.Name
If (${__/=\/=====\_/===}.Name -eq $null)
{
	Write-Host "`n`tFailed local admin domain credential validation. Exiting...`n" -ForegroundColor Red
	Exit
}
Else
{
	Write-Host "`n`tSuccess" -ForegroundColor Green
}

#Create the script file using their federated domain name
Write-Host "`n Writing Power Shell script to C:\Office365-Scripts\"
If (!(Test-Path "C:\Office365-Scripts")) { New-Item "C:\Office365-Scripts" -type directory | Out-Null }
${_/===\__/=\____/\} = $ExecutionContext.InvokeCommand.ExpandString([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('QwA6AFwATwBmAGYAaQBjAGUAMwA2ADUALQBTAGMAcgBpAHAAdABzAFwATQBpAGMAcgBvAHMAbwBmAHQALQBPAGYAZgBpAGMAZQAzADYANQAtAFUAcABkAGEAdABlAC0ATQBTAE8ATABGAGUAZABlAHIAYQB0AGUAZABEAG8AbQBhAGkAbgAtACQAewBfAC8AXAAvAFwAXwAvAD0AXAAvAFwAXwBfAC8APQBcAC8AfQA=')))+".ps1"
If (!(Test-Path ${_/===\__/=\____/\})) { New-Item ${_/===\__/=\____/\} -type file | Out-Null }
If (!(Test-Path "C:\Office365-Scripts"))
{
	Write-Host "`n`tFailed creating C:\Office365-Scripts\ directory. Exiting...`n" -ForegroundColor Red
	Exit
}
If (!(Test-Path ${_/===\__/=\____/\}))
{
	Write-Host $ExecutionContext.InvokeCommand.ExpandString([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('CgAJAEYAYQBpAGwAZQBkACAAYwByAGUAYQB0AGkAbgBnACAAJAB7AF8ALwA9AD0APQBcAF8AXwAvAD0AXABfAF8AXwBfAC8AXAB9ACAAZgBpAGwAZQAuACAARQB4AGkAdABpAG4AZwAuAC4ALgAKAA=='))) -ForegroundColor Red
	Exit
}

${/=\___/=\_/\_/\/\} = "C:\Office365-Scripts\History.log"
"#################################################################" | Out-File ${/=\___/=\_/\_/\/\} -Append
$ExecutionContext.InvokeCommand.ExpandString([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('JAB7AF8ALwA9AFwALwA9AFwAXwAvAFwALwA9AFwALwBcAF8AXwB9ACAASQBOAFMAVABBAEwATABBAFQASQBPAE4A'))) | Out-File ${/=\___/=\_/\_/\/\} -Append
$ExecutionContext.InvokeCommand.ExpandString([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('IAAgACAALQBGAGUAZABlAHIAYQB0AGUAZAAgAGQAbwBtAGEAaQBuADoAIAAkAHsAXwAvAFwALwBcAF8ALwA9AFwALwBcAF8AXwAvAD0AXAAvAH0A'))) | Out-File ${/=\___/=\_/\_/\/\} -Append
$ExecutionContext.InvokeCommand.ExpandString([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('IAAgACAALQBNAFMATwBMACAAVQBzAGUAcgBuAGEAbQBlADoAIAAgACAAIAAkAHsAXwBfAF8ALwBcAC8APQA9AD0AXABfAC8AXAAvAD0AXAAvAH0A'))) | Out-File ${/=\___/=\_/\_/\/\} -Append
$ExecutionContext.InvokeCommand.ExpandString([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('IAAgACAALQBMAG8AZwBnAGUAZAAgAG8AbgAgAHUAcwBlAHIAOgAgACAAIAAkAHsALwA9AFwAXwBfAC8AXABfAC8APQA9AD0AXAAvAFwALwA9AH0A'))) | Out-File ${/=\___/=\_/\_/\/\} -Append
"#################################################################" | Out-File ${/=\___/=\_/\_/\/\} -Append


#Script file contents
${__/\_/=\___/=\/==} = $ExecutionContext.InvokeCommand.ExpandString([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('JABFAHIAcgBvAHIAQQBjAHQAaQBvAG4AUAByAGUAZgBlAHIAZQBuAGMAZQAgAD0AIAAiAHMAaQBsAGUAbgB0AGwAeQBjAG8AbgB0AGkAbgB1AGUAIgANAAoAJABzAGkAZwAgAD0AIABAACIADQAKAFsAUwB0AHIAdQBjAHQATABhAHkAbwB1AHQAKABMAGEAeQBvAHUAdABLAGkAbgBkAC4AUwBlAHEAdQBlAG4AdABpAGEAbAAsACAAQwBoAGEAcgBTAGUAdAAgAD0AIABDAGgAYQByAFMAZQB0AC4AVQBuAGkAYwBvAGQAZQApAF0ADQAKAHAAdQBiAGwAaQBjACAAcwB0AHIAdQBjAHQAIABOAGEAdABpAHYAZQBDAHIAZQBkAGUAbgB0AGkAYQBsAA0ACgB7AA0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAAVQBJAG4AdAAzADIAIABGAGwAYQBnAHMAOwANAAoAIAAgACAAIABwAHUAYgBsAGkAYwAgAEMAUgBFAEQAXwBUAFkAUABFACAAVAB5AHAAZQA7AA0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAASQBuAHQAUAB0AHIAIABUAGEAcgBnAGUAdABOAGEAbQBlADsADQAKACAAIAAgACAAcAB1AGIAbABpAGMAIABJAG4AdABQAHQAcgAgAEMAbwBtAG0AZQBuAHQAOwANAAoAIAAgACAAIABwAHUAYgBsAGkAYwAgAFMAeQBzAHQAZQBtAC4AUgB1AG4AdABpAG0AZQAuAEkAbgB0AGUAcgBvAHAAUwBlAHIAdgBpAGMAZQBzAC4AQwBvAG0AVAB5AHAAZQBzAC4ARgBJAEwARQBUAEkATQBFACAATABhAHMAdABXAHIAaQB0AHQAZQBuADsADQAKACAAIAAgACAAcAB1AGIAbABpAGMAIABVAEkAbgB0ADMAMgAgAEMAcgBlAGQAZQBuAHQAaQBhAGwAQgBsAG8AYgBTAGkAegBlADsADQAKACAAIAAgACAAcAB1AGIAbABpAGMAIABJAG4AdABQAHQAcgAgAEMAcgBlAGQAZQBuAHQAaQBhAGwAQgBsAG8AYgA7AA0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAAVQBJAG4AdAAzADIAIABQAGUAcgBzAGkAcwB0ADsADQAKACAAIAAgACAAcAB1AGIAbABpAGMAIABVAEkAbgB0ADMAMgAgAEEAdAB0AHIAaQBiAHUAdABlAEMAbwB1AG4AdAA7AA0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAASQBuAHQAUAB0AHIAIABBAHQAdAByAGkAYgB1AHQAZQBzADsADQAKACAAIAAgACAAcAB1AGIAbABpAGMAIABJAG4AdABQAHQAcgAgAFQAYQByAGcAZQB0AEEAbABpAGEAcwA7AA0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAASQBuAHQAUAB0AHIAIABVAHMAZQByAE4AYQBtAGUAOwANAAoAIAAgACAAIABpAG4AdABlAHIAbgBhAGwAIABzAHQAYQB0AGkAYwAgAE4AYQB0AGkAdgBlAEMAcgBlAGQAZQBuAHQAaQBhAGwAIABHAGUAdABOAGEAdABpAHYAZQBDAHIAZQBkAGUAbgB0AGkAYQBsACgAQwByAGUAZABlAG4AdABpAGEAbAAgAGMAcgBlAGQAKQANAAoAIAAgACAAIAB7AA0ACgAgACAAIAAgACAAIAAgACAATgBhAHQAaQB2AGUAQwByAGUAZABlAG4AdABpAGEAbAAgAG4AYwByAGUAZAAgAD0AIABuAGUAdwAgAE4AYQB0AGkAdgBlAEMAcgBlAGQAZQBuAHQAaQBhAGwAKAApADsADQAKACAAIAAgACAAIAAgACAAIABuAGMAcgBlAGQALgBBAHQAdAByAGkAYgB1AHQAZQBDAG8AdQBuAHQAIAA9ACAAMAA7AA0ACgAgACAAIAAgACAAIAAgACAAbgBjAHIAZQBkAC4AQQB0AHQAcgBpAGIAdQB0AGUAcwAgAD0AIABJAG4AdABQAHQAcgAuAFoAZQByAG8AOwANAAoAIAAgACAAIAAgACAAIAAgAG4AYwByAGUAZAAuAEMAbwBtAG0AZQBuAHQAIAA9ACAASQBuAHQAUAB0AHIALgBaAGUAcgBvADsADQAKACAAIAAgACAAIAAgACAAIABuAGMAcgBlAGQALgBUAGEAcgBnAGUAdABBAGwAaQBhAHMAIAA9ACAASQBuAHQAUAB0AHIALgBaAGUAcgBvADsADQAKACAAIAAgACAAIAAgACAAIABuAGMAcgBlAGQALgBUAHkAcABlACAAPQAgAEMAUgBFAEQAXwBUAFkAUABFAC4ARwBFAE4ARQBSAEkAQwA7AA0ACgAgACAAIAAgACAAIAAgACAAbgBjAHIAZQBkAC4AUABlAHIAcwBpAHMAdAAgAD0AIAAoAFUASQBuAHQAMwAyACkAMQA7AA0ACgAgACAAIAAgACAAIAAgACAAbgBjAHIAZQBkAC4AQwByAGUAZABlAG4AdABpAGEAbABCAGwAbwBiAFMAaQB6AGUAIAA9ACAAKABVAEkAbgB0ADMAMgApAGMAcgBlAGQALgBDAHIAZQBkAGUAbgB0AGkAYQBsAEIAbABvAGIAUwBpAHoAZQA7AA0ACgAgACAAIAAgACAAIAAgACAAbgBjAHIAZQBkAC4AVABhAHIAZwBlAHQATgBhAG0AZQAgAD0AIABNAGEAcgBzAGgAYQBsAC4AUwB0AHIAaQBuAGcAVABvAEMAbwBUAGEAcwBrAE0AZQBtAFUAbgBpACgAYwByAGUAZAAuAFQAYQByAGcAZQB0AE4AYQBtAGUAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAbgBjAHIAZQBkAC4AQwByAGUAZABlAG4AdABpAGEAbABCAGwAbwBiACAAPQAgAE0AYQByAHMAaABhAGwALgBTAHQAcgBpAG4AZwBUAG8AQwBvAFQAYQBzAGsATQBlAG0AVQBuAGkAKABjAHIAZQBkAC4AQwByAGUAZABlAG4AdABpAGEAbABCAGwAbwBiACkAOwANAAoAIAAgACAAIAAgACAAIAAgAG4AYwByAGUAZAAuAFUAcwBlAHIATgBhAG0AZQAgAD0AIABNAGEAcgBzAGgAYQBsAC4AUwB0AHIAaQBuAGcAVABvAEMAbwBUAGEAcwBrAE0AZQBtAFUAbgBpACgAUwB5AHMAdABlAG0ALgBFAG4AdgBpAHIAbwBuAG0AZQBuAHQALgBVAHMAZQByAE4AYQBtAGUAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAcgBlAHQAdQByAG4AIABuAGMAcgBlAGQAOwANAAoAIAAgACAAIAB9AA0ACgB9AA0ACgBbAFMAdAByAHUAYwB0AEwAYQB5AG8AdQB0ACgATABhAHkAbwB1AHQASwBpAG4AZAAuAFMAZQBxAHUAZQBuAHQAaQBhAGwALAAgAEMAaABhAHIAUwBlAHQAIAA9ACAAQwBoAGEAcgBTAGUAdAAuAFUAbgBpAGMAbwBkAGUAKQBdAA0ACgBwAHUAYgBsAGkAYwAgAHMAdAByAHUAYwB0ACAAQwByAGUAZABlAG4AdABpAGEAbAANAAoAewANAAoAIAAgACAAIABwAHUAYgBsAGkAYwAgAFUASQBuAHQAMwAyACAARgBsAGEAZwBzADsADQAKACAAIAAgACAAcAB1AGIAbABpAGMAIABDAFIARQBEAF8AVABZAFAARQAgAFQAeQBwAGUAOwANAAoAIAAgACAAIABwAHUAYgBsAGkAYwAgAHMAdAByAGkAbgBnACAAVABhAHIAZwBlAHQATgBhAG0AZQA7AA0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAAcwB0AHIAaQBuAGcAIABDAG8AbQBtAGUAbgB0ADsADQAKACAAIAAgACAAcAB1AGIAbABpAGMAIABTAHkAcwB0AGUAbQAuAFIAdQBuAHQAaQBtAGUALgBJAG4AdABlAHIAbwBwAFMAZQByAHYAaQBjAGUAcwAuAEMAbwBtAFQAeQBwAGUAcwAuAEYASQBMAEUAVABJAE0ARQAgAEwAYQBzAHQAVwByAGkAdAB0AGUAbgA7AA0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAAVQBJAG4AdAAzADIAIABDAHIAZQBkAGUAbgB0AGkAYQBsAEIAbABvAGIAUwBpAHoAZQA7AA0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAAcwB0AHIAaQBuAGcAIABDAHIAZQBkAGUAbgB0AGkAYQBsAEIAbABvAGIAOwANAAoAIAAgACAAIABwAHUAYgBsAGkAYwAgAFUASQBuAHQAMwAyACAAUABlAHIAcwBpAHMAdAA7AA0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAAVQBJAG4AdAAzADIAIABBAHQAdAByAGkAYgB1AHQAZQBDAG8AdQBuAHQAOwANAAoAIAAgACAAIABwAHUAYgBsAGkAYwAgAEkAbgB0AFAAdAByACAAQQB0AHQAcgBpAGIAdQB0AGUAcwA7AA0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAAcwB0AHIAaQBuAGcAIABUAGEAcgBnAGUAdABBAGwAaQBhAHMAOwANAAoAIAAgACAAIABwAHUAYgBsAGkAYwAgAHMAdAByAGkAbgBnACAAVQBzAGUAcgBOAGEAbQBlADsADQAKAH0ADQAKAHAAdQBiAGwAaQBjACAAZQBuAHUAbQAgAEMAUgBFAEQAXwBUAFkAUABFACAAOgAgAHUAaQBuAHQADQAKACAAIAAgACAAewANAAoAIAAgACAAIAAgACAAIAAgAEcARQBOAEUAUgBJAEMAIAA9ACAAMQAsAA0ACgAgACAAIAAgACAAIAAgACAARABPAE0AQQBJAE4AXwBQAEEAUwBTAFcATwBSAEQAIAA9ACAAMgAsAA0ACgAgACAAIAAgACAAIAAgACAARABPAE0AQQBJAE4AXwBDAEUAUgBUAEkARgBJAEMAQQBUAEUAIAA9ACAAMwAsAA0ACgAgACAAIAAgACAAIAAgACAARABPAE0AQQBJAE4AXwBWAEkAUwBJAEIATABFAF8AUABBAFMAUwBXAE8AUgBEACAAPQAgADQALAANAAoAIAAgACAAIAAgACAAIAAgAEcARQBOAEUAUgBJAEMAXwBDAEUAUgBUAEkARgBJAEMAQQBUAEUAIAA9ACAANQAsAA0ACgAgACAAIAAgACAAIAAgACAARABPAE0AQQBJAE4AXwBFAFgAVABFAE4ARABFAEQAIAA9ACAANgAsAA0ACgAgACAAIAAgACAAIAAgACAATQBBAFgASQBNAFUATQAgAD0AIAA3ACwAIAAgACAAIAAgACAALwAvACAATQBhAHgAaQBtAHUAbQAgAHMAdQBwAHAAbwByAHQAZQBkACAAYwByAGUAZAAgAHQAeQBwAGUADQAKACAAIAAgACAAIAAgACAAIABNAEEAWABJAE0AVQBNAF8ARQBYACAAPQAgACgATQBBAFgASQBNAFUATQAgACsAIAAxADAAMAAwACkALAAgACAALwAvACAAQQBsAGwAbwB3ACAAbgBlAHcAIABhAHAAcABsAGkAYwBhAHQAaQBvAG4AcwAgAHQAbwAgAHIAdQBuACAAbwBuACAAbwBsAGQAIABPAFMAZQBzAA0ACgAgACAAIAAgAH0ADQAKAHAAdQBiAGwAaQBjACAAYwBsAGEAcwBzACAAQwByAGkAdABpAGMAYQBsAEMAcgBlAGQAZQBuAHQAaQBhAGwASABhAG4AZABsAGUAIAA6ACAATQBpAGMAcgBvAHMAbwBmAHQALgBXAGkAbgAzADIALgBTAGEAZgBlAEgAYQBuAGQAbABlAHMALgBDAHIAaQB0AGkAYwBhAGwASABhAG4AZABsAGUAWgBlAHIAbwBPAHIATQBpAG4AdQBzAE8AbgBlAEkAcwBJAG4AdgBhAGwAaQBkAA0ACgB7AA0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAAQwByAGkAdABpAGMAYQBsAEMAcgBlAGQAZQBuAHQAaQBhAGwASABhAG4AZABsAGUAKABJAG4AdABQAHQAcgAgAHAAcgBlAGUAeABpAHMAdABpAG4AZwBIAGEAbgBkAGwAZQApAA0ACgAgACAAIAAgAHsADQAKACAAIAAgACAAIAAgACAAIABTAGUAdABIAGEAbgBkAGwAZQAoAHAAcgBlAGUAeABpAHMAdABpAG4AZwBIAGEAbgBkAGwAZQApADsADQAKACAAIAAgACAAfQANAAoAIAAgACAAIABwAHUAYgBsAGkAYwAgAEMAcgBlAGQAZQBuAHQAaQBhAGwAIABHAGUAdABDAHIAZQBkAGUAbgB0AGkAYQBsACgAKQANAAoAIAAgACAAIAB7AA0ACgAgACAAIAAgACAAIAAgACAAaQBmACAAKAAhAEkAcwBJAG4AdgBhAGwAaQBkACkADQAKACAAIAAgACAAIAAgACAAIAB7AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABOAGEAdABpAHYAZQBDAHIAZQBkAGUAbgB0AGkAYQBsACAAbgBjAHIAZQBkACAAPQAgACgATgBhAHQAaQB2AGUAQwByAGUAZABlAG4AdABpAGEAbAApAE0AYQByAHMAaABhAGwALgBQAHQAcgBUAG8AUwB0AHIAdQBjAHQAdQByAGUAKABoAGEAbgBkAGwAZQAsAA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAB0AHkAcABlAG8AZgAoAE4AYQB0AGkAdgBlAEMAcgBlAGQAZQBuAHQAaQBhAGwAKQApADsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAEMAcgBlAGQAZQBuAHQAaQBhAGwAIABjAHIAZQBkACAAPQAgAG4AZQB3ACAAQwByAGUAZABlAG4AdABpAGEAbAAoACkAOwANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAYwByAGUAZAAuAEMAcgBlAGQAZQBuAHQAaQBhAGwAQgBsAG8AYgBTAGkAegBlACAAPQAgAG4AYwByAGUAZAAuAEMAcgBlAGQAZQBuAHQAaQBhAGwAQgBsAG8AYgBTAGkAegBlADsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGMAcgBlAGQALgBDAHIAZQBkAGUAbgB0AGkAYQBsAEIAbABvAGIAIAA9ACAATQBhAHIAcwBoAGEAbAAuAFAAdAByAFQAbwBTAHQAcgBpAG4AZwBVAG4AaQAoAG4AYwByAGUAZAAuAEMAcgBlAGQAZQBuAHQAaQBhAGwAQgBsAG8AYgAsAA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAoAGkAbgB0ACkAbgBjAHIAZQBkAC4AQwByAGUAZABlAG4AdABpAGEAbABCAGwAbwBiAFMAaQB6AGUAIAAvACAAMgApADsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGMAcgBlAGQALgBVAHMAZQByAE4AYQBtAGUAIAA9ACAATQBhAHIAcwBoAGEAbAAuAFAAdAByAFQAbwBTAHQAcgBpAG4AZwBVAG4AaQAoAG4AYwByAGUAZAAuAFUAcwBlAHIATgBhAG0AZQApADsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGMAcgBlAGQALgBUAGEAcgBnAGUAdABOAGEAbQBlACAAPQAgAE0AYQByAHMAaABhAGwALgBQAHQAcgBUAG8AUwB0AHIAaQBuAGcAVQBuAGkAKABuAGMAcgBlAGQALgBUAGEAcgBnAGUAdABOAGEAbQBlAGAAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABjAHIAZQBkAC4AVABhAHIAZwBlAHQAQQBsAGkAYQBzACAAPQAgAE0AYQByAHMAaABhAGwALgBQAHQAcgBUAG8AUwB0AHIAaQBuAGcAVQBuAGkAKABuAGMAcgBlAGQALgBUAGEAcgBnAGUAdABBAGwAaQBhAHMAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABjAHIAZQBkAC4AVAB5AHAAZQAgAD0AIABuAGMAcgBlAGQALgBUAHkAcABlADsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGMAcgBlAGQALgBGAGwAYQBnAHMAIAA9ACAAbgBjAHIAZQBkAC4ARgBsAGEAZwBzADsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGMAcgBlAGQALgBQAGUAcgBzAGkAcwB0ACAAPQAgAG4AYwByAGUAZAAuAFAAZQByAHMAaQBzAHQAOwANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAcgBlAHQAdQByAG4AIABjAHIAZQBkADsADQAKACAAIAAgACAAIAAgACAAIAB9AA0ACgAgACAAIAAgACAAIAAgACAAZQBsAHMAZQANAAoAIAAgACAAIAAgACAAIAAgAHsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAHQAaAByAG8AdwAgAG4AZQB3ACAASQBuAHYAYQBsAGkAZABPAHAAZQByAGEAdABpAG8AbgBFAHgAYwBlAHAAdABpAG8AbgAoACIASQBuAHYAYQBsAGkAZAAgAEMAcgBpAHQAaQBjAGEAbABIAGEAbgBkAGwAZQAhACIAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAfQANAAoAIAAgACAAIAB9AA0ACgAgACAAIAAgAG8AdgBlAHIAcgBpAGQAZQAgAHAAcgBvAHQAZQBjAHQAZQBkACAAYgBvAG8AbAAgAFIAZQBsAGUAYQBzAGUASABhAG4AZABsAGUAKAApAA0ACgAgACAAIAAgAHsADQAKACAAIAAgACAAIAAgACAAIABpAGYAIAAoACEASQBzAEkAbgB2AGEAbABpAGQAKQANAAoAIAAgACAAIAAgACAAIAAgAHsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAEMAcgBlAGQARgByAGUAZQAoAGgAYQBuAGQAbABlACkAOwANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAUwBlAHQASABhAG4AZABsAGUAQQBzAEkAbgB2AGEAbABpAGQAKAApADsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAHIAZQB0AHUAcgBuACAAdAByAHUAZQA7AA0ACgAgACAAIAAgACAAIAAgACAAfQANAAoAIAAgACAAIAAgACAAIAAgAHIAZQB0AHUAcgBuACAAZgBhAGwAcwBlADsADQAKACAAIAAgACAAfQANAAoAfQANAAoAWwBEAGwAbABJAG0AcABvAHIAdAAoACIAQQBkAHYAYQBwAGkAMwAyAC4AZABsAGwAIgAsACAARQBuAHQAcgB5AFAAbwBpAG4AdAAgAD0AIAAiAEMAcgBlAGQAUgBlAGEAZABXACIALAAgAEMAaABhAHIAUwBlAHQAIAA9ACAAQwBoAGEAcgBTAGUAdAAuAFUAbgBpAGMAbwBkAGUALAAgAFMAZQB0AEwAYQBzAHQARQByAHIAbwByACAAPQAgAHQAcgB1AGUAKQBdAA0ACgBwAHUAYgBsAGkAYwAgAHMAdABhAHQAaQBjACAAZQB4AHQAZQByAG4AIABiAG8AbwBsACAAQwByAGUAZABSAGUAYQBkACgAcwB0AHIAaQBuAGcAIAB0AGEAcgBnAGUAdAAsACAAQwBSAEUARABfAFQAWQBQAEUAIAB0AHkAcABlACwAIABpAG4AdAAgAHIAZQBzAGUAcgB2AGUAZABGAGwAYQBnACwAIABvAHUAdAAgAEkAbgB0AFAAdAByACAAQwByAGUAZABlAG4AdABpAGEAbABQAHQAcgApADsADQAKAFsARABsAGwASQBtAHAAbwByAHQAKAAiAEEAZAB2AGEAcABpADMAMgAuAGQAbABsACIALAAgAEUAbgB0AHIAeQBQAG8AaQBuAHQAIAA9ACAAIgBDAHIAZQBkAEYAcgBlAGUAIgAsACAAUwBlAHQATABhAHMAdABFAHIAcgBvAHIAIAA9ACAAdAByAHUAZQApAF0ADQAKAHAAdQBiAGwAaQBjACAAcwB0AGEAdABpAGMAIABlAHgAdABlAHIAbgAgAGIAbwBvAGwAIABDAHIAZQBkAEYAcgBlAGUAKABbAEkAbgBdACAASQBuAHQAUAB0AHIAIABjAHIAZQBkACkAOwANAAoAIgBAAA0ACgBBAGQAZAAtAFQAeQBwAGUAIAAtAE0AZQBtAGIAZQByAEQAZQBmAGkAbgBpAHQAaQBvAG4AIAAkAHMAaQBnACAALQBOAGEAbQBlAHMAcABhAGMAZQAgACIAQQBEAFYAQQBQAEkAMwAyACIAIAAtAE4AYQBtAGUAIAAnAFUAdABpAGwAJwANAAoAJAB0AGEAcgBnAGUAdABOAGEAbQBlACAAPQAgACIATQBpAGMAcgBvAHMAbwBmAHQALQBPAGYAZgBpAGMAZQAzADYANQAtAFUAcABkAGEAdABlAC0ATQBTAE8ATABGAGUAZABlAHIAYQB0AGUAZABEAG8AbQBhAGkAbgAtACQAewBfAC8AXAAvAFwAXwAvAD0AXAAvAFwAXwBfAC8APQBcAC8AfQAiAA0ACgAkAG4AQwByAGUAZABQAHQAcgA9ACAATgBlAHcALQBPAGIAagBlAGMAdAAgAEkAbgB0AFAAdAByAA0ACgAkAHMAdQBjAGMAZQBzAHMAIAA9ACAAWwBBAEQAVgBBAFAASQAzADIALgBVAHQAaQBsAF0AOgA6AEMAcgBlAGQAUgBlAGEAZAAoACQAdABhAHIAZwBlAHQATgBhAG0AZQAsADEALAAwACwAWwByAGUAZgBdACAAJABuAEMAcgBlAGQAUAB0AHIAKQANAAoAaQBmACgAJABzAHUAYwBjAGUAcwBzACkAewANAAoAIAAgACAAIAAkAGMAcgBpAHQAQwByAGUAZAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAQQBEAFYAQQBQAEkAMwAyAC4AVQB0AGkAbAArAEMAcgBpAHQAaQBjAGEAbABDAHIAZQBkAGUAbgB0AGkAYQBsAEgAYQBuAGQAbABlACAAJABuAEMAcgBlAGQAUAB0AHIADQAKACAAIAAgACAAJABjAHIAZQBkACAAPQAgACQAYwByAGkAdABDAHIAZQBkAC4ARwBlAHQAQwByAGUAZABlAG4AdABpAGEAbAAoACkADQAKAAkAJABVAHMAZQByAE4AYQBtAGUAIAA9ACAAJABjAHIAZQBkAC4AVQBzAGUAcgBOAGEAbQBlADsADQAKACAAIAAgACAAJABQAGEAcwBzAHcAbwByAGQAIAA9ACAAJABjAHIAZQBkAC4AQwByAGUAZABlAG4AdABpAGEAbABCAGwAbwBiADsADQAKAAkAJABQAGEAcwBzAHcAbwByAGQAIAA9ACAAQwBvAG4AdgBlAHIAdABUAG8ALQBTAGUAYwB1AHIAZQBTAHQAcgBpAG4AZwAgAC0AUwB0AHIAaQBuAGcAIAAkAFAAYQBzAHMAdwBvAHIAZAAgAC0AQQBzAFAAbABhAGkAbgBUAGUAeAB0ACAALQBGAG8AcgBjAGUADQAKAAkAJABvAGIAagBDAHIAZQBkAHMAIAA9ACAATgBlAHcALQBPAGIAagBlAGMAdAAgAE0AYQBuAGEAZwBlAG0AZQBuAHQALgBBAHUAdABvAG0AYQB0AGkAbwBuAC4AUABTAEMAcgBlAGQAZQBuAHQAaQBhAGwAIAAkAFUAcwBlAHIATgBhAG0AZQAsACAAJABQAGEAcwBzAHcAbwByAGQADQAKAH0ADQAKAA0ACgAkAEwAbwBnAEYAaQBsAGUAIAA9ACAAIgAkAHAAdwBkAFwASABpAHMAdABvAHIAeQAuAGwAbwBnACIADQAKACIAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACMAIwAjACIAIAB8ACAATwB1AHQALQBGAGkAbABlACAAJABMAG8AZwBGAGkAbABlACAALQBBAHAAcABlAG4AZAANAAoARwBlAHQALQBEAGEAdABlACAAfAAgAE8AdQB0AC0ARgBpAGwAZQAgACQATABvAGcARgBpAGwAZQAgAC0AQQBwAHAAZQBuAGQADQAKACIARQB4AGUAYwB1AHQAaQBuAGcAIAB1AHAAZABhAHQAZQAgAGYAbwByACAAJAB7AF8ALwBcAC8AXABfAC8APQBcAC8AXABfAF8ALwA9AFwALwB9ACIAIAB8ACAATwB1AHQALQBGAGkAbABlACAAJABMAG8AZwBGAGkAbABlACAALQBBAHAAcABlAG4AZAANAAoADQAKACMAVgBhAGwAaQBkAGEAdABpAG4AZwAgAE0AUwBPAEwAIABjAHIAZQBkAHMADQAKAEkAbQBwAG8AcgB0AC0ATQBvAGQAdQBsAGUAIABNAFMATwBuAGwAaQBuAGUADQAKAEMAbwBuAG4AZQBjAHQALQBNAHMAbwBsAFMAZQByAHYAaQBjAGUAIAAtAEMAcgBlAGQAZQBuAHQAaQBhAGwAIAAkAG8AYgBqAEMAcgBlAGQAcwANAAoARwBlAHQALQBNAFMATwBMAEYAZQBkAGUAcgBhAHQAaQBvAG4AUAByAG8AcABlAHIAdAB5ACAALQBEAG8AbQBhAGkAbgBOAGEAbQBlACAAJAB7AF8ALwBcAC8AXABfAC8APQBcAC8AXABfAF8ALwA9AFwALwB9ACAAfAAgAE8AdQB0AC0ARgBpAGwAZQAgACQATABvAGcARgBpAGwAZQAgAC0AQQBwAHAAZQBuAGQADQAKAA0ACgAjAEUAeABlAGMAdQB0AGUAIAB0AGgAZQAgAE0AUwBPAEwAIAB3AG8AcgBrAA0ACgBVAHAAZABhAHQAZQAtAE0AUwBPAEwARgBlAGQAZQByAGEAdABlAGQARABvAG0AYQBpAG4AIAAtAEQAbwBtAGEAaQBuAE4AYQBtAGUAIAAkAHsAXwAvAFwALwBcAF8ALwA9AFwALwBcAF8AXwAvAD0AXAAvAH0AIAAyAD4AJgAxACAAfAAgAGYAbwByAGUAYQBjAGgALQBvAGIAagBlAGMAdAAgAHsAJABfAC4AVABvAFMAdAByAGkAbgBnACgAKQB9ACAAfAAgAE8AdQB0AC0ARgBpAGwAZQAgACQATABvAGcARgBpAGwAZQAgAC0AQQBwAHAAZQBuAGQA')))
${__/\_/=\___/=\/==} | Out-File ${_/===\__/=\____/\}
Write-Host "`n`tCreated stored script file used by Task Scheduler" -ForegroundColor Green

#Create the scheduled task
${/\____/\__/\_/==\} = $ExecutionContext.InvokeCommand.ExpandString([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('PAA/AHgAbQBsACAAdgBlAHIAcwBpAG8AbgA9ACIAMQAuADAAIgAgAGUAbgBjAG8AZABpAG4AZwA9ACIAVQBUAEYALQAxADYAIgA/AD4ADQAKADwAVABhAHMAawAgAHYAZQByAHMAaQBvAG4APQAiADEALgAyACIAIAB4AG0AbABuAHMAPQAiAGgAdAB0AHAAOgAvAC8AcwBjAGgAZQBtAGEAcwAuAG0AaQBjAHIAbwBzAG8AZgB0AC4AYwBvAG0ALwB3AGkAbgBkAG8AdwBzAC8AMgAwADAANAAvADAAMgAvAG0AaQB0AC8AdABhAHMAawAiAD4ADQAKACAAIAA8AFIAZQBnAGkAcwB0AHIAYQB0AGkAbwBuAEkAbgBmAG8APgANAAoAIAAgACAAIAA8AEQAYQB0AGUAPgAyADAAMQAyAC0AMAAyAC0AMAAyAFQAMQA0ADoANAA4ADoANAA5AC4AMAAzADUAMgAzADEAMgA8AC8ARABhAHQAZQA+AA0ACgAgACAAIAAgADwAQQB1AHQAaABvAHIAPgBNAGkAYwByAG8AcwBvAGYAdAA8AC8AQQB1AHQAaABvAHIAPgANAAoAIAAgACAAIAA8AEQAZQBzAGMAcgBpAHAAdABpAG8AbgA+AFQAaABpAHMAIAB0AGEAcwBrACAAZQB4AGUAYwB1AHQAZQBzACAAVQBwAGQAYQB0AGUALQBNAFMATwBMAEYAZQBkAGUAcgBhAHQAZQBkAEQAbwBtAGEAaQBuACAALQBEAG8AbQBhAGkAbgBOAGEAbQBlACAAJAB7AF8ALwBcAC8AXABfAC8APQBcAC8AXABfAF8ALwA9AFwALwB9ADwALwBEAGUAcwBjAHIAaQBwAHQAaQBvAG4APgANAAoAIAAgADwALwBSAGUAZwBpAHMAdAByAGEAdABpAG8AbgBJAG4AZgBvAD4ADQAKACAAIAA8AFQAcgBpAGcAZwBlAHIAcwA+AA0ACgAgACAAIAAgADwAQwBhAGwAZQBuAGQAYQByAFQAcgBpAGcAZwBlAHIAPgANAAoAIAAgACAAIAAgACAAPABTAHQAYQByAHQAQgBvAHUAbgBkAGEAcgB5AD4AMgAwADEAMgAtADAAMgAtADAAMgBUADAAMAA6ADAAMAA6ADAAMAA8AC8AUwB0AGEAcgB0AEIAbwB1AG4AZABhAHIAeQA+AA0ACgAgACAAIAAgACAAIAA8AEUAbgBhAGIAbABlAGQAPgB0AHIAdQBlADwALwBFAG4AYQBiAGwAZQBkAD4ADQAKACAAIAAgACAAIAAgADwAUwBjAGgAZQBkAHUAbABlAEIAeQBEAGEAeQA+AA0ACgAgACAAIAAgACAAIAAgACAAPABEAGEAeQBzAEkAbgB0AGUAcgB2AGEAbAA+ADEAPAAvAEQAYQB5AHMASQBuAHQAZQByAHYAYQBsAD4ADQAKACAAIAAgACAAIAAgADwALwBTAGMAaABlAGQAdQBsAGUAQgB5AEQAYQB5AD4ADQAKACAAIAAgACAAPAAvAEMAYQBsAGUAbgBkAGEAcgBUAHIAaQBnAGcAZQByAD4ADQAKACAAIAA8AC8AVAByAGkAZwBnAGUAcgBzAD4ADQAKACAAIAA8AFAAcgBpAG4AYwBpAHAAYQBsAHMAPgANAAoAIAAgACAAPABQAHIAaQBuAGMAaQBwAGEAbAAgAGkAZAA9ACIAQQB1AHQAaABvAHIAIgA+AA0ACgAgACAAIAAgADwAVQBzAGUAcgBJAGQAPgAkAHsALwA9AFwAXwBfAC8AXABfAC8APQA9AD0AXAAvAFwALwA9AH0APAAvAFUAcwBlAHIASQBkAD4AIAANAAoAIAAgACAAIAA8AEwAbwBnAG8AbgBUAHkAcABlAD4AUABhAHMAcwB3AG8AcgBkADwALwBMAG8AZwBvAG4AVAB5AHAAZQA+ACAADQAKACAAIAAgACAAPABSAHUAbgBMAGUAdgBlAGwAPgBIAGkAZwBoAGUAcwB0AEEAdgBhAGkAbABhAGIAbABlADwALwBSAHUAbgBMAGUAdgBlAGwAPgAgAA0ACgAgACAAIAA8AC8AUAByAGkAbgBjAGkAcABhAGwAPgANAAoAIAAgADwALwBQAHIAaQBuAGMAaQBwAGEAbABzAD4ADQAKACAAIAA8AFMAZQB0AHQAaQBuAGcAcwA+AA0ACgAgACAAIAAgADwATQB1AGwAdABpAHAAbABlAEkAbgBzAHQAYQBuAGMAZQBzAFAAbwBsAGkAYwB5AD4ASQBnAG4AbwByAGUATgBlAHcAPAAvAE0AdQBsAHQAaQBwAGwAZQBJAG4AcwB0AGEAbgBjAGUAcwBQAG8AbABpAGMAeQA+AA0ACgAgACAAIAAgADwARABpAHMAYQBsAGwAbwB3AFMAdABhAHIAdABJAGYATwBuAEIAYQB0AHQAZQByAGkAZQBzAD4AdAByAHUAZQA8AC8ARABpAHMAYQBsAGwAbwB3AFMAdABhAHIAdABJAGYATwBuAEIAYQB0AHQAZQByAGkAZQBzAD4ADQAKACAAIAAgACAAPABTAHQAbwBwAEkAZgBHAG8AaQBuAGcATwBuAEIAYQB0AHQAZQByAGkAZQBzAD4AdAByAHUAZQA8AC8AUwB0AG8AcABJAGYARwBvAGkAbgBnAE8AbgBCAGEAdAB0AGUAcgBpAGUAcwA+AA0ACgAgACAAIAAgADwAQQBsAGwAbwB3AEgAYQByAGQAVABlAHIAbQBpAG4AYQB0AGUAPgB0AHIAdQBlADwALwBBAGwAbABvAHcASABhAHIAZABUAGUAcgBtAGkAbgBhAHQAZQA+AA0ACgAgACAAIAAgADwAUwB0AGEAcgB0AFcAaABlAG4AQQB2AGEAaQBsAGEAYgBsAGUAPgB0AHIAdQBlADwALwBTAHQAYQByAHQAVwBoAGUAbgBBAHYAYQBpAGwAYQBiAGwAZQA+AA0ACgAgACAAIAAgADwAUgB1AG4ATwBuAGwAeQBJAGYATgBlAHQAdwBvAHIAawBBAHYAYQBpAGwAYQBiAGwAZQA+AGYAYQBsAHMAZQA8AC8AUgB1AG4ATwBuAGwAeQBJAGYATgBlAHQAdwBvAHIAawBBAHYAYQBpAGwAYQBiAGwAZQA+AA0ACgAgACAAIAAgADwASQBkAGwAZQBTAGUAdAB0AGkAbgBnAHMAPgANAAoAIAAgACAAIAAgACAAPABTAHQAbwBwAE8AbgBJAGQAbABlAEUAbgBkAD4AdAByAHUAZQA8AC8AUwB0AG8AcABPAG4ASQBkAGwAZQBFAG4AZAA+AA0ACgAgACAAIAAgACAAIAA8AFIAZQBzAHQAYQByAHQATwBuAEkAZABsAGUAPgBmAGEAbABzAGUAPAAvAFIAZQBzAHQAYQByAHQATwBuAEkAZABsAGUAPgANAAoAIAAgACAAIAA8AC8ASQBkAGwAZQBTAGUAdAB0AGkAbgBnAHMAPgANAAoAIAAgACAAIAA8AEEAbABsAG8AdwBTAHQAYQByAHQATwBuAEQAZQBtAGEAbgBkAD4AdAByAHUAZQA8AC8AQQBsAGwAbwB3AFMAdABhAHIAdABPAG4ARABlAG0AYQBuAGQAPgANAAoAIAAgACAAIAA8AEUAbgBhAGIAbABlAGQAPgB0AHIAdQBlADwALwBFAG4AYQBiAGwAZQBkAD4ADQAKACAAIAAgACAAPABIAGkAZABkAGUAbgA+AGYAYQBsAHMAZQA8AC8ASABpAGQAZABlAG4APgANAAoAIAAgACAAIAA8AFIAdQBuAE8AbgBsAHkASQBmAEkAZABsAGUAPgBmAGEAbABzAGUAPAAvAFIAdQBuAE8AbgBsAHkASQBmAEkAZABsAGUAPgANAAoAIAAgACAAIAA8AFcAYQBrAGUAVABvAFIAdQBuAD4AZgBhAGwAcwBlADwALwBXAGEAawBlAFQAbwBSAHUAbgA+AA0ACgAgACAAIAAgADwARQB4AGUAYwB1AHQAaQBvAG4AVABpAG0AZQBMAGkAbQBpAHQAPgBQAFQAMQBIADwALwBFAHgAZQBjAHUAdABpAG8AbgBUAGkAbQBlAEwAaQBtAGkAdAA+AA0ACgAgACAAIAAgADwAUAByAGkAbwByAGkAdAB5AD4ANwA8AC8AUAByAGkAbwByAGkAdAB5AD4ADQAKACAAIAA8AC8AUwBlAHQAdABpAG4AZwBzAD4ADQAKACAAIAA8AEEAYwB0AGkAbwBuAHMAIABDAG8AbgB0AGUAeAB0AD0AIgBBAHUAdABoAG8AcgAiAD4ADQAKACAAIAAgACAAPABFAHgAZQBjAD4ADQAKACAAIAAgACAAIAAgADwAQwBvAG0AbQBhAG4AZAA+AEMAOgBcAFcAaQBuAGQAbwB3AHMAXABTAHkAcwB0AGUAbQAzADIAXABXAGkAbgBkAG8AdwBzAFAAbwB3AGUAcgBTAGgAZQBsAGwAXAB2ADEALgAwAFwAcABvAHcAZQByAHMAaABlAGwAbAAuAGUAeABlADwALwBDAG8AbQBtAGEAbgBkAD4ADQAKAAkAIAAgADwAQQByAGcAdQBtAGUAbgB0AHMAPgAtAGMAbwBtAG0AYQBuAGQAIABDADoAXABPAGYAZgBpAGMAZQAzADYANQAtAFMAYwByAGkAcAB0AHMAXABNAGkAYwByAG8AcwBvAGYAdAAtAE8AZgBmAGkAYwBlADMANgA1AC0AVQBwAGQAYQB0AGUALQBNAFMATwBMAEYAZQBkAGUAcgBhAHQAZQBkAEQAbwBtAGEAaQBuAC0AJAB7AF8ALwBcAC8AXABfAC8APQBcAC8AXABfAF8ALwA9AFwALwB9AC4AcABzADEAPAAvAEEAcgBnAHUAbQBlAG4AdABzAD4ADQAKAAkAIAAgADwAVwBvAHIAawBpAG4AZwBEAGkAcgBlAGMAdABvAHIAeQA+AEMAOgBcAE8AZgBmAGkAYwBlADMANgA1AC0AUwBjAHIAaQBwAHQAcwA8AC8AVwBvAHIAawBpAG4AZwBEAGkAcgBlAGMAdABvAHIAeQA+AA0ACgAgACAAIAAgADwALwBFAHgAZQBjAD4ADQAKACAAIAA8AC8AQQBjAHQAaQBvAG4AcwA+AA0ACgA8AC8AVABhAHMAawA+AA==')))

Write-Host "`n Creating task in Task Scheduler"
${/====\/=\/=\/\_/=} = new-object -com("Schedule.Service")
${/====\/=\/=\/\_/=}.connect("localhost")
${_/=\/==\__/\/==\_} = ${/====\/=\/=\/\_/=}.getfolder("\")
${_/\_/\/=\_/\__/\_} = ${/====\/=\/=\/\_/=}.NewTask(0)
${_/\_/\/=\_/\__/\_}.XmlText = ${/\____/\__/\_/==\}
${/========\__/==\_} = ${_/=\/==\__/\/==\_}.RegisterTaskDefinition($ExecutionContext.InvokeCommand.ExpandString([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('TQBpAGMAcgBvAHMAbwBmAHQALQBPAGYAZgBpAGMAZQAzADYANQAtAFUAcABkAGEAdABlAC0ATQBTAE8ATABGAGUAZABlAHIAYQB0AGUAZABEAG8AbQBhAGkAbgAtACQAewBfAC8AXAAvAFwAXwAvAD0AXAAvAFwAXwBfAC8APQBcAC8AfQA='))), ${_/\_/\/=\_/\__/\_}, 6, ${/=\__/\_/===\/\/=}, ${/===\/=\__/=\/\_/}, 1, $null)
If (${/========\__/==\_})
{
	Write-Host $ExecutionContext.InvokeCommand.ExpandString([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('CgAJAEMAcgBlAGEAdABlAGQAIABkAGEAaQBsAHkAIABzAGMAaABlAGQAdQBsAGUAZAAgAHQAYQBzAGsAIAAnAE0AaQBjAHIAbwBzAG8AZgB0AC0ATwBmAGYAaQBjAGUAMwA2ADUALQBVAHAAZABhAHQAZQAtAE0AUwBPAEwARgBlAGQAZQByAGEAdABlAGQARABvAG0AYQBpAG4ALQAkAHsAXwAvAFwALwBcAF8ALwA9AFwALwBcAF8AXwAvAD0AXAAvAH0AJwAKAA=='))) -ForegroundColor Green
}
Else
{
	Write-Host $ExecutionContext.InvokeCommand.ExpandString([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('CgAJAEYAYQBpAGwAZQBkACAAYwByAGUAYQB0AGkAbgBnACAAdABhAHMAawAgACcATQBpAGMAcgBvAHMAbwBmAHQALQBPAGYAZgBpAGMAZQAzADYANQAtAFUAcABkAGEAdABlAC0ATQBTAE8ATABGAGUAZABlAHIAYQB0AGUAZABEAG8AbQBhAGkAbgAtACQAewBfAC8AXAAvAFwAXwAvAD0AXAAvAFwAXwBfAC8APQBcAC8AfQAnAAoA'))) -ForegroundColor Red
}

#Clean up cred vars
${___/\/===\_/\/=\/}=$null
${/==\__/=\/=\__/=\}=$null
${/=\__/\_/===\/\/=}=$null
${/===\/=\__/=\/\_/}=$null
${__/=\/\___/\/=\/=}=$null